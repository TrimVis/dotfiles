#!/usr/bin/env bash

#
# A simple script, that regulates the volume using amixer
#

INC=
DEC=
MUT=
NOT=
BLO=

while getopts i:d:mnb:h option
do
    case "${option}"
        in
        i) INC=${OPTARG};;
        d) DEC=${OPTARG};;
        m) MUT="TRUE";;
        n) NOT="TRUE";;
        b) BLO=${OPTARG};;
        h) echo "A simple script, that regulates the volume using amixer.

USAGE:
-i <val>   Increase volume by val (in percent)
-d <val>   Decrease volume by val (in percent)
-n         Send out a notification using my notify script
-b <val>   For i3blocks support: Force update of i3block entry with this val
-m         Toggle mute
-h         Displays this help script"
    esac
done

MUTE=$(amixer get Master -M | awk '{ print $6 }' | tail -1)

if [ -z "$MUT" ]
then
    [ -z "$INC" ] || (amixer -D pulse -M sset Master "${INC}%+"; [ -z "$NOT" ] || notify -c "volume" -t "ðŸ”Š Sound" -b "Increased volume to $(amixer get Master -M | awk -F'[' '{ print $2 }' | awk -F'%' '{ print $1 }' | tail -1)")
    [ -z "$DEC" ] || (amixer -D pulse -M sset Master "${DEC}%-"; [ -z "$NOT" ] || notify -c "volume" -t "ðŸ”Š Sound" -b "Decreased volume to $(amixer get Master -M | awk -F'[' '{ print $2 }' | awk -F'%' '{ print $1 }' | tail -1)")
else
    if [ "$MUTE" = "[on]" ]
    then
        amixer -D pulse -M set Master toggle; [ -z "$NOT" ] || notify -c "volume" -t "ðŸ”Š Sound" -b "Muted volume"; playerctl pause
    else
        amixer -D pulse -M set Master toggle; [ -z "$NOT" ] || notify -c "volume" -t "ðŸ”Š Sound" -b "Unmuted volume"
    fi
fi


[ -z "$BLO" ] || (pkill -SIGRTMIN+${BLO} -x i3blocks)

